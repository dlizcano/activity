---
title: "Activity Pattern for coati"
description: |
  Activity Pattern for _Nasua nasua_
author:
  - name: Diego J. Lizcano  
    url: http://dlizcano.github.io/
    affiliation: Awake Travel
    affiliation_url: https://monitoreo-acustico.netlify.app/
    orcid_id: 0000-0002-9648-0576
date: "`r Sys.Date()`"
output:
  distill::distill_article:
    self_contained: false
code_folding: true
highlight: pygments
creative_commons: CC BY-SA
citation_url: https://dlizcano.github.io/activity
base_url: https://dlizcano.github.io/activity
preview: https://dlizcano.github.io/activity/fig/nasua.png
twitter:
  site: "@rstudio"
  creator: "@dlizcano"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

# Learn more about creating blogs with Distill at:
# https://rstudio.github.io/distill/blog.html

```


# Descripción

El coati o cusumbo (_Nasua nasua_) un mamífero relacionado con el mapache, pero se caracteriza por tener hocico largo. Su piel es o pardo suave o negra, con vientre más claro, y anillos blanco en la cola. Su cabeza es delgada con una nariz alargada, orejas pequeñas, pies negros, cola larga no prensil usada para balancearse. Los adultos miden 41-67 cm de la cabeza a la base de la cola, agregando 30-60 cm a su longitud total. A los hombros alcanzan cerca de 30 cm, y pesan entre 3-8 kg.

### Detalles de Wikipedia

https://es.wikipedia.org/wiki/Nasua_nasua


# Mapa de distribución

```{r}


################
library(readr)
library(tidyverse)
library(sf)
library(camtrapR)
library(raster)
library(tmap)
library(tmaptools)
library(mapview)

# source("D:/BoxFiles/Box Sync/CodigoR/patrones_actividad/R/TEAM.R")

source("D:/BoxFiles/Box Sync/github/activity/R/TEAM.R")

##### Read datos.raw
##### Read datos.raw
# deployment <- read_csv("D:/BoxFiles/Box Sync/CodigoR/patrones_actividad/data/deployments.csv")

deployment <- read_csv("C:/CodigoR/Awake_datos/data/Awake_full/deployments.csv")

# images <- read_csv("D:/BoxFiles/Box Sync/CodigoR/patrones_actividad/data/images.csv")
# full.data <- left_join(images, deployment)

images <- read_csv("C:/CodigoR/Awake_datos/data/Awake_full/images.csv")
sequences <- read_csv("C:/CodigoR/Awake_datos/data/Awake_full/sequences.csv")
full.data.1 <- left_join(images, sequences)
full.data <- left_join(full.data.1, deployment)

#### elimina dos camaras sin coordenadas
#ind <- which(is.na(datos.raw1$Lat))
#datos.raw <- datos.raw1[-ind,]

#### make sf object
datos.raw_sf <- st_as_sf(full.data, coords = c("longitude", "latitude"), 
                        crs = "+proj=longlat +ellps=GRS80 +no_defs")
# make sf
camaras <-  st_transform (datos.raw_sf, "+proj=longlat +ellps=GRS80 +no_defs") 

# make species mat
mat.per.sp<-f.matrix.creator2(data = full.data, year = 2022)
# mat.per.sp <- mat.per.sp[-1] # elimina NA 
sp.names<-names(mat.per.sp) # species names

# fix species for camtrapR
camaras$species_epitet <- camaras$species
camaras$Species <- str_c(camaras$genus, camaras$species, sep = " ", collapse = NULL)
camaras$DateTimeOriginal <- as.character(strptime (camaras$timestamp, "%Y-%m-%d %H:%M:%S"))#sub(" UTC", "", camaras$timestamp) # remove the UTC

camaras$Date <- as.character(strptime (camaras$timestamp, "%Y-%m-%d"))
camaras$Time <- format(as.POSIXct(camaras$timestamp), format = "%H:%M:%S")

#camaras
camaras_unique <- deployment %>%
      dplyr::select(anfitrion, camera_name, latitude, longitude) %>%  
      st_as_sf( coords = c("longitude", "latitude"), 
                        crs = "+proj=longlat +ellps=GRS80 +no_defs")

###################


```


### _Nasua nasua_

Zoom a la region de interes

```{r eval=TRUE, layout="l-screen-inset shaded"}

nasua <- filter(camaras, Species=="Nasua nasua")# & subproject_name=="El Escondite")
by_sp <- camaras %>%  group_by(Species) %>% tally()
fotografias <- nasua %>%  group_by(deployment_id) %>% tally()
names(fotografias) <-  c("Camara", "Fotos coati", "geometry")


mapview(camaras_unique, cex=1, col.regions = "black") + 
  mapview(fotografias,  cex = "Fotos coati",
                col.regions = "red", alpha = 0, map.types=c("Esri.WorldImagery", "OpenTopoMap"))

```


# Grafica actividad

```{r eval=TRUE, results='asis'}


# make shorter table
Nasua <- camaras %>% 
  dplyr::select(Species, DateTimeOriginal, Date, Time, anfitrion) %>% 
  dplyr::filter (Species =="Nasua nasua" )  %>%  
  as.data.frame() %>% 
  dlply(.(anfitrion)) # return list by anfitrion


 for (i in 1:length(Nasua)){
  if(dim(Nasua[[i]])[1] <= 10) # skip if menos 10 records
    next
  cat("###", names(Nasua)[i])
  #plot.new( )
  #plot.window( xlim=c(-1,25), ylim=c(0,1))
  # par(mar = c(5, 4, 3, 3) + 0.1)
  activityDensity (recordTable = Nasua[[i]],
                   species     = "Nasua nasua",
                   recordDateTimeCol="DateTimeOriginal") 
  rect(0, 0, 6, 2.2, col= rgb(0.211,0.211,0.211, alpha=0.2), border = "transparent")
  rect(18, 0, 24, 2.2, col= rgb(0.211,0.211,0.211, alpha=0.2), border = "transparent")
 }


```

# Foto

 [![nasua](https://dlizcano.github.io/activity/fig/nasua_small.jpg)]( https://dlizcano.github.io/activity/fig/nasua_large.jpg)

# Información de la sesión en R.

```{r sesion, results='markup'}
print(sessionInfo(), locale = FALSE)
```

