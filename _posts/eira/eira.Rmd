---
title: "Activity Pattern for tayra"
description: |
  Activity Pattern for _Eira barbara_
author:
  - name: Diego J. Lizcano  
    url: http://dlizcano.github.io/
    affiliation: Awake Travel
    affiliation_url: https://monitoreo-acustico.netlify.app/
    orcid_id: 0000-0002-9648-0576
date: "`r Sys.Date()`"
output:
  distill::distill_article:
    self_contained: false
code_folding: true
highlight: pygments
creative_commons: CC BY-SA
citation_url: https://dlizcano.github.io/activity
base_url: https://dlizcano.github.io/activity
preview: https://dlizcano.github.io/activity/fig/eira.png
twitter:
  site: "@rstudio"
  creator: "@dlizcano"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

# Learn more about creating blogs with Distill at:
# https://rstudio.github.io/distill/blog.html

```


# Descripción

la tayra (_Eira barbara_), también llamada viejo de monte, irará, eirá, tolomuco, cabeza de mate, cabeza de viejo, manco, sanjool, hurón mayor o comadreja  es una especie de mamífero carnívoro de la familia Mustelidae. Habita en selvas tropicales desde las planicies costeras de México hasta el norte de Argentina. Mide alrededor de 70 cm y pesa 5 kg. Tiene la cabeza blanquecina o amarilla y es de hábitos arborícolas. Es omnívoro, se alimenta de frutos, insectos, carroña y pequeños vertebrados.

### Detalles de Wikipedia

https://es.wikipedia.org/wiki/Eira_barbara


# Mapa de distribución

```{r}

################
library(readr)
library(tidyverse)
library(sf)
library(camtrapR)
library(raster)
library(tmap)
library(tmaptools)
library(mapview)

# source("D:/BoxFiles/Box Sync/CodigoR/patrones_actividad/R/TEAM.R")

source("D:/BoxFiles/Box Sync/github/activity/R/TEAM.R")

##### Read datos.raw
##### Read datos.raw
# deployment <- read_csv("D:/BoxFiles/Box Sync/CodigoR/patrones_actividad/data/deployments.csv")

deployment <- read_csv("C:/CodigoR/Awake_datos/data/Awake_full/deployments.csv")

# images <- read_csv("D:/BoxFiles/Box Sync/CodigoR/patrones_actividad/data/images.csv")
# full.data <- left_join(images, deployment)

images <- read_csv("C:/CodigoR/Awake_datos/data/Awake_full/images.csv")
full.data <- left_join(images, deployment)

#### elimina dos camaras sin coordenadas
#ind <- which(is.na(datos.raw1$Lat))
#datos.raw <- datos.raw1[-ind,]

#### make sf object
datos.raw_sf <- st_as_sf(full.data, coords = c("longitude", "latitude"), 
                        crs = "+proj=longlat +ellps=GRS80 +no_defs")
# make sf
camaras <-  st_transform (datos.raw_sf, "+proj=longlat +ellps=GRS80 +no_defs") 

# make species mat
mat.per.sp<-f.matrix.creator2(data = full.data, year = 2022)
# mat.per.sp <- mat.per.sp[-1] # elimina NA 
sp.names<-names(mat.per.sp) # species names

# fix species for camtrapR
camaras$species_epitet <- camaras$species
camaras$Species <- str_c(camaras$genus, camaras$species, sep = " ", collapse = NULL)
camaras$DateTimeOriginal <- as.character(strptime (camaras$timestamp, "%Y-%m-%d %H:%M:%S"))#sub(" UTC", "", camaras$timestamp) # remove the UTC

camaras$Date <- as.character(strptime (camaras$timestamp, "%Y-%m-%d"))
camaras$Time <- format(as.POSIXct(camaras$timestamp), format = "%H:%M:%S")

#camaras
camaras_unique <- deployment %>%
      dplyr::select(anfitrion, camera_name, latitude, longitude) %>%  
      st_as_sf( coords = c("longitude", "latitude"), 
                        crs = "+proj=longlat +ellps=GRS80 +no_defs")

###################

```


### _Eira barbara_

Zoom a la region de interes

```{r eval=TRUE, layout="l-screen-inset shaded"}



sp_place <- filter(camaras, Species=="Eira barbara")#& subproject_name==c("Selva Vides", "El Escondite"))
by_sp <- camaras %>%  group_by(Species) %>% tally()
fotografias <- sp_place %>%  group_by(deployment_id) %>% tally()
names(fotografias) <-  c("Camara", "Fotos tayra", "geometry")


# library(terra); library(maptiles)
# sierraFebpts <- st_as_sf(sp_place, coords = c("longitude", "latitude"), crs=4326)
# sierraBase <- get_tiles(sierraFebpts, provider="OpenTopoMap", zoom = 14)
# st_crs(sierraFebpts)$epsg
# plotRGB(sierraBase)
# points(vect(sierraFebpts))


# bb <- c(-76.77936, #0.78941
#         0.80541, 
#         -76.69007, 
#         0.90982)
# 
# bb2 <- c(-76.77246, 0.8788705, -76.7505, 0.9008353)
# 
# # putumayo_osm1 <- read_osm(bb, type="stamen-terrain",  mergeTiles = TRUE) 
# 
# # eira_window <- qtm(putumayo_osm1) + 
# #  tm_shape(veg_cover_b) + 
# #      tm_fill("Cobertura", palette = "-Greens", colorNA =NULL, title = "Coberturas", alpha = 0.5) + 
# #    tm_shape(celdas2017) + tm_borders(lwd=1, alpha = .6) + 
# #  tm_shape(rio) +
# #  tm_polygons("Rio", colorNA =NULL, border.col = "blue", palette = "blue") +  #tm_symbols (size = 0.5) +
#  tm_shape(fotografias) + # tm_symbols (col="red", size = 0.25) + 
#     tm_bubbles(size = "Fotos tayra", col = "red", border.col= "red", alpha= 0.5, 
#                legend.size.is.portrait=TRUE) +
#     # tm_dots(col = "Species", size = 0.25, 
#     #        shape = 16, title = "Especie", legend.show = TRUE,
#     #       legend.is.portrait = TRUE, legend.z = NA) +
#     tm_layout(scale = 0.9, #font symbol sizes,are controlled by this value 
#             outer.margins = c(0,.1,0,.2), #bottom, left, top, right margin
#             legend.position = c(1.01,.1), 
#             legend.outside.size = 0.1,
#             legend.title.size = 1.6,
#             legend.height = 0.9,
#             legend.width = 1.5,
#             legend.text.size = 1, 
#             legend.hist.size = 0.5) + 
#   tm_layout(frame=T) + tm_scale_bar(text.size = 0.65) + 
#   tm_compass(type="arrow", position=c("left", "top"), show.labels = 1)
# 
# #plot
# eira_window

# tmap_save(tinamu_window, "fig/Vichada/tinamu_map.png", width=1500, height=1000, dpi = 150)

mapview(camaras_unique, cex=1, col.regions = "black") + 
  mapview(fotografias,  cex = "Fotos tayra",
                col.regions = "red", alpha = 0, map.types=c("Esri.WorldImagery", "OpenTopoMap"))

```


# Grafica actividad

```{r eval=TRUE}


# make shorter table
Eira <- camaras %>% 
  dplyr::select(Species, DateTimeOriginal, Date, Time, anfitrion) %>% 
  dplyr::filter (Species =="Eira barbara" )  %>%  
  as.data.frame() %>% 
  dlply(.(anfitrion)) # return list by anfitrion


 for (i in 1:length(Eira)){
  if(dim(Eira[[i]])[1] <= 9) # skip if menos 10 records
    next
  if(i == 3) # skip 3 
    next
  cat("###", names(Eira)[i])
  #plot.new( )
  #plot.window( xlim=c(-1,25), ylim=c(0,1))
  # par(mar = c(5, 4, 3, 3) + 0.1)
  activityDensity (recordTable = Eira[[i]],
                   species     = "Eira barbara",
                   recordDateTimeCol="DateTimeOriginal") 
  rect(0, 0, 6, 0.9, col= rgb(0.211,0.211,0.211, alpha=0.2), border = "transparent")
  rect(18, 0, 24, 0.9, col= rgb(0.211,0.211,0.211, alpha=0.2), border = "transparent")
 }
# activityDensity (recordTable = cuniculus,
#                  species     = "Cuniculus paca",
#                  writePNG = TRUE,
#                  createDir=TRUE,
#                  plotR = TRUE,
#                  pngMaxPix = 800,
#                  plotDirectory = "D:/BoxFiles/Box Sync/CodigoR/patrones_actividad/fig/paca_activ.png"
#                  )


```

# Foto

 [![tamandua](https://dlizcano.github.io/activity/fig/eira_small.jpg)]( https://dlizcano.github.io/activity/fig/eira_large.jpg)

# Información de la sesión en R.

```{r sesion, results='markup'}
print(sessionInfo(), locale = FALSE)
```

